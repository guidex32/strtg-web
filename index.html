<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í–æ–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –∫–∞—Ä—Ç—ã</title>
    <style>
        :root {
            --dark-blue: #1a365d;
            --medium-blue: #2a4a7f;
            --light-blue: #3c6ab8;
            --dark-orange: #d35400;
            --medium-orange: #e67e22;
            --light-orange: #f39c12;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
            --success-color: #27ae60;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, var(--dark-blue) 0%, var(--dark-color) 100%);
            color: var(--light-color);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            background: linear-gradient(to right, var(--medium-blue), var(--light-blue));
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        h1 {
            font-size: 28px;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
        }
        
        .main-content {
            display: flex;
            gap: 20px;
        }
        
        .map-container {
            flex: 3;
            position: relative;
            background-color: var(--medium-blue);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
            min-height: 600px;
        }
        
        #map-image {
            width: 100%;
            height: 100%;
            object-fit: contain;
            display: block;
        }
        
        .controls {
            flex: 1;
            background: linear-gradient(to bottom, var(--medium-blue), var(--dark-blue));
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
            display: flex;
            flex-direction: column;
        }
        
        .section-title {
            font-size: 18px;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--light-orange);
        }
        
        .btn {
            display: block;
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: none;
            border-radius: 4px;
            background: linear-gradient(to bottom, var(--light-blue), var(--medium-blue));
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }
        
        .btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
        }
        
        .btn-attack {
            background: linear-gradient(to bottom, var(--light-orange), var(--dark-orange));
        }
        
        .btn-interceptor {
            background: linear-gradient(to bottom, var(--danger-color), #c0392b);
        }
        
        .btn-db {
            background: linear-gradient(to bottom, var(--success-color), #27ae60);
        }
        
        .btn-auth {
            background: linear-gradient(to bottom, var(--warning-color), #e67e22);
        }
        
        .country {
            position: absolute;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            transition: transform 0.3s;
            border: 2px solid transparent;
            z-index: 10;
        }
        
        .country:hover {
            transform: scale(1.1);
            border-color: var(--light-orange);
        }
        
        .country-flag {
            width: 80%;
            height: 80%;
            object-fit: cover;
            border-radius: 50%;
        }
        
        .target {
            position: absolute;
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
            font-size: 24px;
            z-index: 5;
        }
        
        .target-bunker {
            background-color: #8c7b6b;
        }
        
        .target-command {
            background-color: var(--medium-blue);
        }
        
        .target-warehouse {
            background-color: var(--light-orange);
        }
        
        .target-airfield {
            background-color: var(--success-color);
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: linear-gradient(to bottom, var(--medium-blue), var(--dark-blue));
            padding: 25px;
            border-radius: 8px;
            width: 400px;
            max-width: 90%;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            border: 1px solid var(--light-blue);
        }
        
        .modal-title {
            font-size: 20px;
            margin-bottom: 20px;
            text-align: center;
            color: var(--light-orange);
        }
        
        .weapon-option {
            display: flex;
            align-items: center;
            padding: 10px;
            margin: 10px 0;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .weapon-option:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        .weapon-icon {
            font-size: 24px;
            margin-right: 15px;
        }
        
        .projectile {
            position: absolute;
            width: 30px;
            height: 30px;
            z-index: 100;
            transition: left 0.5s linear, top 0.5s linear;
        }
        
        .missile {
            color: #e74c3c;
            font-size: 30px;
        }
        
        .drone {
            color: #7f8c8d;
            font-size: 30px;
        }
        
        .health-bar {
            position: absolute;
            bottom: -10px;
            left: 0;
            width: 100%;
            height: 5px;
            background-color: #555;
            border-radius: 2px;
        }
        
        .health-fill {
            height: 100%;
            background-color: var(--success-color);
            border-radius: 2px;
            width: 100%;
        }
        
        .log-container {
            margin-top: 20px;
            max-height: 200px;
            overflow-y: auto;
            background-color: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 4px;
            flex-grow: 1;
        }
        
        .log-entry {
            padding: 5px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 14px;
        }
        
        .log-time {
            color: var(--light-orange);
            margin-right: 5px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 8px;
            border-radius: 4px;
            border: 1px solid var(--light-blue);
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
        }
        
        .trail {
            position: absolute;
            background: black;
            height: 1px;
            transform-origin: 0 0;
            z-index: 4;
            border-top: 1px dashed black;
        }
        
        .country-name {
            position: absolute;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 10px;
            white-space: nowrap;
            color: white;
            text-shadow: 1px 1px 2px black;
        }
        
        .target-name {
            position: absolute;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 10px;
            white-space: nowrap;
            color: white;
            text-shadow: 1px 1px 2px black;
        }
        
        .instructions {
            position: absolute;
            top: 10px;
            left: 10px;
            background-color: rgba(0, 0, 0, 0.6);
            padding: 10px;
            border-radius: 4px;
            font-size: 14px;
            max-width: 250px;
            z-index: 20;
            display: none;
        }
        
        .player-info {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .player-flag {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            object-fit: cover;
        }
        
        .auth-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .loading {
            display: none;
            text-align: center;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>–ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –≤–æ–µ–Ω–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π –Ω–∞ –∫–∞—Ä—Ç–µ</h1>
            <div id="current-mode">–¢–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º: –í—ã–±–æ—Ä</div>
        </header>
        
        <div class="main-content">
            <div class="map-container" id="map-container">
                <div class="instructions" id="instructions"></div>
                <img id="map-image" src="" alt="–í–æ–µ–Ω–Ω–∞—è –∫–∞—Ä—Ç–∞">
            </div>
            
            <div class="controls">
                <div class="player-info">
                    <img id="player-flag" class="player-flag" src="" alt="–§–ª–∞–≥ –∏–≥—Ä–æ–∫–∞">
                    <span id="player-name">–ì–æ—Å—Ç—å</span>
                </div>
                
                <div id="auth-buttons" class="auth-container">
                    <button class="btn btn-auth" id="btn-register">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
                    <button class="btn btn-auth" id="btn-login">–í—Ö–æ–¥</button>
                </div>
                
                <div id="game-controls" style="display: none;">
                    <h2 class="section-title">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h2>
                    <button class="btn" id="btn-add-country">–î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω—É</button>
                    <button class="btn" id="btn-add-target">–î–æ–±–∞–≤–∏—Ç—å —Ü–µ–ª—å</button>
                    <button class="btn btn-attack" id="btn-attack-mode">–†–µ–∂–∏–º –∞—Ç–∞–∫–∏</button>
                    
                    <h2 class="section-title" style="margin-top: 30px;">–î–µ–π—Å—Ç–≤–∏—è</h2>
                    <button class="btn btn-interceptor" id="btn-interceptor" disabled>–ü–µ—Ä–µ—Ö–≤–∞—Ç—á–∏–∫ (CD: <span id="interceptor-cd">0</span>s)</button>
                    
                    <h2 class="section-title" style="margin-top: 30px;">–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö</h2>
                    <button class="btn btn-db" id="btn-save-db">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –ë–î</button>
                    <button class="btn btn-db" id="btn-load-db">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ –ë–î</button>
                    <div class="loading" id="db-loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                    
                    <h2 class="section-title" style="margin-top: 30px;">–ñ—É—Ä–Ω–∞–ª —Å–æ–±—ã—Ç–∏–π</h2>
                    <div class="log-container" id="log-container">
                        <!-- –ñ—É—Ä–Ω–∞–ª –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ –æ—Ä—É–∂–∏—è -->
    <div class="modal" id="weapon-modal">
        <div class="modal-content">
            <h2 class="modal-title">–í—ã–±–æ—Ä –æ—Ä—É–∂–∏—è –¥–ª—è –∞—Ç–∞–∫–∏</h2>
            
            <div class="weapon-option" data-weapon="otrk">
                <div class="weapon-icon">üöÄ</div>
                <div>
                    <strong>–û–¢–†–ö</strong>
                    <p>–ë—ã—Å—Ç—Ä–∞—è —Ä–∞–∫–µ—Ç–∞, –ª–µ–≥—á–µ —Å–±–∏—Ç—å. –£—Ä–æ–Ω: –¥–æ 500</p>
                </div>
            </div>
            
            <div class="weapon-option" data-weapon="cluster">
                <div class="weapon-icon">üí•</div>
                <div>
                    <strong>–ö–∞—Å—Å–µ—Ç–Ω–∞—è</strong>
                    <p>–ù–∞–Ω–æ—Å–∏—Ç —É—Ä–æ–Ω –ø–æ –ø–ª–æ—â–∞–¥–∏. –£—Ä–æ–Ω: –¥–æ 200</p>
                </div>
            </div>
            
            <div class="weapon-option" data-weapon="cruise">
                <div class="weapon-icon">‚úàÔ∏è</div>
                <div>
                    <strong>–ö—Ä—ã–ª–∞—Ç–∞—è</strong>
                    <p>–¢—Ä—É–¥–Ω–µ–µ —Å–±–∏—Ç—å, –º–µ–¥–ª–µ–Ω–Ω–µ–µ. –£—Ä–æ–Ω: –¥–æ 500</p>
                </div>
            </div>
            
            <div class="weapon-option" data-weapon="drone">
                <div class="weapon-icon">üõ∏</div>
                <div>
                    <strong>–ë–ü–õ–ê</strong>
                    <p>–í–∑—Ä—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–∏. –£—Ä–æ–Ω: –¥–æ 500</p>
                </div>
            </div>
            
            <button class="btn" id="btn-cancel-attack" style="margin-top: 20px;">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ç—Ä–∞–Ω—ã -->
    <div class="modal" id="country-modal">
        <div class="modal-content">
            <h2 class="modal-title">–°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω—ã</h2>
            
            <div class="form-group">
                <label for="country-name">–ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω—ã (—Ç–æ–ª—å–∫–æ —Ä—É—Å—Å–∫–∏–µ –±—É–∫–≤—ã, –º–∞–∫—Å. 256 —Å–∏–º–≤–æ–ª–æ–≤)</label>
                <input type="text" id="country-name" maxlength="256" pattern="[–ê-–Ø–∞-—è–Å—ë\s]+" required>
            </div>
            
            <div class="form-group">
                <label for="country-flag">URL —Ñ–ª–∞–≥–∞ (jpg/png)</label>
                <input type="text" id="country-flag" required>
            </div>
            
            <button class="btn" id="btn-create-country">–°–æ–∑–¥–∞—Ç—å</button>
            <button class="btn" id="btn-cancel-country">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è —Ü–µ–ª–∏ -->
    <div class="modal" id="target-modal">
        <div class="modal-content">
            <h2 class="modal-title">–°–æ–∑–¥–∞–Ω–∏–µ —Ü–µ–ª–∏</h2>
            
            <div class="form-group">
                <label for="target-type">–¢–∏–ø —Ü–µ–ª–∏</label>
                <select id="target-type">
                    <option value="bunker">–ë—É–Ω–∫–µ—Ä</option>
                    <option value="command">–ö–æ–º–∞–Ω–¥–Ω—ã–π —Ü–µ–Ω—Ç—Ä</option>
                    <option value="warehouse">–°–∫–ª–∞–¥ –ë–æ–µ–ø—Ä–∏–ø–∞—Å–æ–≤</option>
                    <option value="airfield">–ê—ç—Ä–æ–¥—Ä–æ–º</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="target-owner">–í–ª–∞–¥–µ–ª–µ—Ü (—Å—Ç—Ä–∞–Ω–∞)</label>
                <select id="target-owner">
                    <!-- –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </select>
            </div>
            
            <button class="btn" id="btn-create-target">–°–æ–∑–¥–∞—Ç—å</button>
            <button class="btn" id="btn-cancel-target">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
    <div class="modal" id="register-modal">
        <div class="modal-content">
            <h2 class="modal-title">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
            
            <div class="form-group">
                <label for="register-username">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                <input type="text" id="register-username" required>
            </div>
            
            <div class="form-group">
                <label for="register-password">–ü–∞—Ä–æ–ª—å</label>
                <input type="password" id="register-password" required>
            </div>
            
            <button class="btn" id="btn-register-submit">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
            <button class="btn" id="btn-cancel-register">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—Ö–æ–¥–∞ -->
    <div class="modal" id="login-modal">
        <div class="modal-content">
            <h2 class="modal-title">–í—Ö–æ–¥</h2>
            
            <div class="form-group">
                <label for="login-username">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                <input type="text" id="login-username" required>
            </div>
            
            <div class="form-group">
                <label for="login-password">–ü–∞—Ä–æ–ª—å</label>
                <input type="password" id="login-password" required>
            </div>
            
            <button class="btn" id="btn-login-submit">–í–æ–π—Ç–∏</button>
            <button class="btn" id="btn-cancel-login">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è - –∑–¥–µ—Å—å –≤—ã –º–æ–∂–µ—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        const CONFIG = {
            mapImage: 'map.jpg', // –ó–ê–ú–ï–ù–ò–¢–ï –Ω–∞ –≤–∞—à–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã
            missileSound: 'rocket.mp3', // –ó–ê–ú–ï–ù–ò–¢–ï –Ω–∞ –≤–∞—à –∑–≤—É–∫ —Ä–∞–∫–µ—Ç—ã
            droneSound: 'drone.mp3', // –ó–ê–ú–ï–ù–ò–¢–ï –Ω–∞ –≤–∞—à –∑–≤—É–∫ –ë–ü–õ–ê
            explosionSound: 'bomb.mp3', // –ó–ê–ú–ï–ù–ò–¢–ï –Ω–∞ –≤–∞—à –∑–≤—É–∫ –≤–∑—Ä—ã–≤–∞
            interceptorSound: 'bomb.mp3', // –ó–ê–ú–ï–ù–ò–¢–ï –Ω–∞ –≤–∞—à –∑–≤—É–∫ –ø–µ—Ä–µ—Ö–≤–∞—Ç—á–∏–∫–∞
            apiUrl: 'api.php' // PHP-—Å–∫—Ä–∏–ø—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î
        };
        
        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        const state = {
            countries: [],
            targets: [],
            projectiles: [],
            attackMode: false,
            addCountryMode: false,
            addTargetMode: false,
            selectedTarget: null,
            selectedCountry: null,
            interceptorCooldown: 0,
            lastLogTime: new Date(),
            currentPlayer: null // –¢–µ–∫—É—â–∏–π –∏–≥—Ä–æ–∫
        };
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const mapContainer = document.getElementById('map-container');
        const mapImage = document.getElementById('map-image');
        const weaponModal = document.getElementById('weapon-modal');
        const countryModal = document.getElementById('country-modal');
        const targetModal = document.getElementById('target-modal');
        const registerModal = document.getElementById('register-modal');
        const loginModal = document.getElementById('login-modal');
        const logContainer = document.getElementById('log-container');
        const interceptorBtn = document.getElementById('btn-interceptor');
        const interceptorCdSpan = document.getElementById('interceptor-cd');
        const currentMode = document.getElementById('current-mode');
        const instructions = document.getElementById('instructions');
        const targetOwnerSelect = document.getElementById('target-owner');
        const playerFlag = document.getElementById('player-flag');
        const playerName = document.getElementById('player-name');
        const authButtons = document.getElementById('auth-buttons');
        const gameControls = document.getElementById('game-controls');
        const dbLoading = document.getElementById('db-loading');
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        function init() {
            // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ä—Ç—ã
            mapImage.src = CONFIG.mapImage;
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
            document.getElementById('btn-add-country').addEventListener('click', enableAddCountryMode);
            document.getElementById('btn-add-target').addEventListener('click', enableAddTargetMode);
            document.getElementById('btn-attack-mode').addEventListener('click', toggleAttackMode);
            document.getElementById('btn-cancel-attack').addEventListener('click', closeWeaponModal);
            document.getElementById('btn-create-country').addEventListener('click', createCountry);
            document.getElementById('btn-cancel-country').addEventListener('click', closeCountryModal);
            document.getElementById('btn-create-target').addEventListener('click', createTarget);
            document.getElementById('btn-cancel-target').addEventListener('click', closeTargetModal);
            document.getElementById('btn-save-db').addEventListener('click', saveToDatabase);
            document.getElementById('btn-load-db').addEventListener('click', loadFromDatabase);
            document.getElementById('btn-register').addEventListener('click', showRegisterModal);
            document.getElementById('btn-login').addEventListener('click', showLoginModal);
            document.getElementById('btn-register-submit').addEventListener('click', registerUser);
            document.getElementById('btn-login-submit').addEventListener('click', loginUser);
            document.getElementById('btn-cancel-register').addEventListener('click', closeRegisterModal);
            document.getElementById('btn-cancel-login').addEventListener('click', closeLoginModal);
            interceptorBtn.addEventListener('click', activateInterceptor);
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞ –æ—Ä—É–∂–∏—è
            document.querySelectorAll('.weapon-option').forEach(option => {
                option.addEventListener('click', function() {
                    launchAttack(this.dataset.weapon);
                });
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –∫–∞—Ä—Ç–µ
            mapContainer.addEventListener('click', handleMapClick);
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ cooldown –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
            setInterval(updateCooldowns, 1000);
            
            updateModeDisplay();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                state.currentPlayer = JSON.parse(savedUser);
                updatePlayerInfo();
                authButtons.style.display = 'none';
                gameControls.style.display = 'block';
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API
        async function apiRequest(endpoint, data = {}) {
            try {
                const response = await fetch(CONFIG.apiUrl + '?action=' + endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                return await response.json();
            } catch (error) {
                addLog('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É: ' + error.message);
                return { success: false, error: error.message };
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ –ø–æ –∫–∞—Ä—Ç–µ
        function handleMapClick(e) {
            if (e.target !== mapImage && e.target !== mapContainer) return;
            
            const rect = mapContainer.getBoundingClientRect();
            const x = ((e.clientX - rect.left) / rect.width) * 100;
            const y = ((e.clientY - rect.top) / rect.height) * 100;
            
            if (state.addCountryMode) {
                state.selectedCountry = { x, y };
                countryModal.style.display = 'flex';
                state.addCountryMode = false;
                updateModeDisplay();
                instructions.style.display = 'none';
            } else if (state.addTargetMode) {
                state.selectedTarget = { x, y };
                updateTargetOwnerOptions();
                targetModal.style.display = 'flex';
                state.addTargetMode = false;
                updateModeDisplay();
                instructions.style.display = 'none';
            }
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
        function showRegisterModal() {
            registerModal.style.display = 'flex';
        }
        
        // –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
        function closeRegisterModal() {
            registerModal.style.display = 'none';
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—Ö–æ–¥–∞
        function showLoginModal() {
            loginModal.style.display = 'flex';
        }
        
        // –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—Ö–æ–¥–∞
        function closeLoginModal() {
            loginModal.style.display = 'none';
        }
        
        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function registerUser() {
            const username = document.getElementById('register-username').value;
            const password = document.getElementById('register-password').value;
            
            if (!username || !password) {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!');
                return;
            }
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
            const result = await apiRequest('register', { username, password });
            
            if (result.success) {
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                state.currentPlayer = { username };
                localStorage.setItem('currentUser', JSON.stringify(state.currentPlayer));
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                updatePlayerInfo();
                authButtons.style.display = 'none';
                gameControls.style.display = 'block';
                closeRegisterModal();
                
                addLog(`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${username} –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω`);
            } else {
                alert('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: ' + result.error);
            }
        }
        
        // –í—Ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function loginUser() {
            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;
            
            if (!username || !password) {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!');
                return;
            }
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ –≤—Ö–æ–¥
            const result = await apiRequest('login', { username, password });
            
            if (result.success) {
                state.currentPlayer = { username };
                localStorage.setItem('currentUser', JSON.stringify(state.currentPlayer));
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                updatePlayerInfo();
                authButtons.style.display = 'none';
                gameControls.style.display = 'block';
                closeLoginModal();
                
                addLog(`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${username} –≤–æ—à–µ–ª –≤ —Å–∏—Å—Ç–µ–º—É`);
            } else {
                alert('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ' + result.error);
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –∏–≥—Ä–æ–∫–µ
        function updatePlayerInfo() {
            if (state.currentPlayer) {
                playerName.textContent = `–ò–≥—Ä–æ–∫: ${state.currentPlayer.username}`;
            }
        }
        
        // –í–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω—ã
        function enableAddCountryMode() {
            resetModes();
            state.addCountryMode = true;
            updateModeDisplay();
            instructions.textContent = '–ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –∫–∞—Ä—Ç–µ, –≥–¥–µ –¥–æ–ª–∂–Ω–∞ –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è —Å—Ç—Ä–∞–Ω–∞';
            instructions.style.display = 'block';
        }
        
        // –í–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ü–µ–ª–∏
        function enableAddTargetMode() {
            if (state.countries.length === 0) {
                alert('–°–Ω–∞—á–∞–ª–∞ –¥–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É —Å—Ç—Ä–∞–Ω—É!');
                return;
            }
            
            resetModes();
            state.addTargetMode = true;
            updateModeDisplay();
            instructions.textContent = '–ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –∫–∞—Ä—Ç–µ, –≥–¥–µ –¥–æ–ª–∂–Ω–∞ –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è —Ü–µ–ª—å';
            instructions.style.display = 'block';
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω—ã
        async function createCountry() {
            const name = document.getElementById('country-name').value;
            const flag = document.getElementById('country-flag').value;
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–∑–≤–∞–Ω–∏—è
            if (!/^[–ê-–Ø–∞-—è–Å—ë\s]+$/.test(name)) {
                alert('–ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω—ã –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ä—É—Å—Å–∫–∏–µ –±—É–∫–≤—ã!');
                return;
            }
            
            const country = {
                id: Date.now(),
                name: name,
                x: state.selectedCountry.x,
                y: state.selectedCountry.y,
                flag: flag,
                owner: state.currentPlayer.username
            };
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ç—Ä–∞–Ω—É –≤ –ë–î
            const result = await apiRequest('save_country', { country });
            
            if (result.success) {
                state.countries.push(country);
                renderCountry(country);
                closeCountryModal();
                addLog(`–°–æ–∑–¥–∞–Ω–∞ —Å—Ç—Ä–∞–Ω–∞: ${name}`);
            } else {
                alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω—ã: ' + result.error);
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–ø—Ü–∏–π –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤ –¥–ª—è —Ü–µ–ª–µ–π
        function updateTargetOwnerOptions() {
            targetOwnerSelect.innerHTML = '';
            state.countries.forEach(country => {
                const option = document.createElement('option');
                option.value = country.id;
                option.textContent = country.name;
                targetOwnerSelect.appendChild(option);
            });
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ —Ü–µ–ª–∏
        async function createTarget() {
            const type = document.getElementById('target-type').value;
            const ownerId = parseInt(document.getElementById('target-owner').value);
            
            const owner = state.countries.find(c => c.id === ownerId);
            
            const target = {
                id: Date.now(),
                type: type,
                x: state.selectedTarget.x,
                y: state.selectedTarget.y,
                health: getMaxHealthByType(type),
                maxHealth: getMaxHealthByType(type),
                owner: ownerId,
                ownerName: owner.name
            };
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ü–µ–ª—å –≤ –ë–î
            const result = await apiRequest('save_target', { target });
            
            if (result.success) {
                state.targets.push(target);
                renderTarget(target);
                closeTargetModal();
                addLog(`–°–æ–∑–¥–∞–Ω–∞ —Ü–µ–ª—å: ${getTargetNameByType(type)} –¥–ª—è ${owner.name}`);
            } else {
                alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ü–µ–ª–∏: ' + result.error);
            }
        }
        
        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω—ã –Ω–∞ –∫–∞—Ä—Ç–µ
        function renderCountry(country) {
            const countryEl = document.createElement('div');
            countryEl.className = 'country';
            countryEl.style.left = `${country.x}%`;
            countryEl.style.top = `${country.y}%`;
            countryEl.dataset.id = country.id;
            countryEl.dataset.owner = country.owner;
            
            const flagImg = document.createElement('img');
            flagImg.className = 'country-flag';
            flagImg.src = country.flag;
            flagImg.alt = `${country.name} flag`;
            
            const nameEl = document.createElement('div');
            nameEl.className = 'country-name';
            nameEl.textContent = country.name;
            
            countryEl.appendChild(flagImg);
            countryEl.appendChild(nameEl);
            mapContainer.appendChild(countryEl);
            
            // –ü—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ —Å—Ç—Ä–∞–Ω—É –≤ —Ä–µ–∂–∏–º–µ –∞—Ç–∞–∫–∏
            countryEl.addEventListener('click', function() {
                if (state.attackMode) {
                    // –ù–µ–ª—å–∑—è –∞—Ç–∞–∫–æ–≤–∞—Ç—å —Å–≤–æ—é —Å—Ç—Ä–∞–Ω—É
                    if (country.owner === state.currentPlayer.username) {
                        addLog('–ù–µ–ª—å–∑—è –∞—Ç–∞–∫–æ–≤–∞—Ç—å —Å–≤–æ—é —Å—Ç—Ä–∞–Ω—É!');
                        return;
                    }
                    
                    state.selectedTarget = country;
                    weaponModal.style.display = 'flex';
                }
            });
        }
        
        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ü–µ–ª–∏ –Ω–∞ –∫–∞—Ä—Ç–µ
        function renderTarget(target) {
            const targetEl = document.createElement('div');
            targetEl.className = `target target-${target.type}`;
            targetEl.style.left = `${target.x}%`;
            targetEl.style.top = `${target.y}%`;
            targetEl.dataset.id = target.id;
            targetEl.dataset.owner = target.owner;
            
            // –ò–∫–æ–Ω–∫–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ —Ü–µ–ª–∏
            targetEl.innerHTML = getIconByTargetType(target.type);
            
            // Health bar
            const healthBar = document.createElement('div');
            healthBar.className = 'health-bar';
            
            const healthFill = document.createElement('div');
            healthFill.className = 'health-fill';
            healthFill.style.width = `${(target.health / target.maxHealth) * 100}%`;
            
            healthBar.appendChild(healthFill);
            targetEl.appendChild(healthBar);
            
            // –ù–∞–∑–≤–∞–Ω–∏–µ —Ü–µ–ª–∏
            const nameEl = document.createElement('div');
            nameEl.className = 'target-name';
            nameEl.textContent = `${getTargetNameByType(target.type)} (${target.ownerName})`;
            targetEl.appendChild(nameEl);
            
            mapContainer.appendChild(targetEl);
            
            // –ü—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ —Ü–µ–ª—å –≤ —Ä–µ–∂–∏–º–µ –∞—Ç–∞–∫–∏
            targetEl.addEventListener('click', function() {
                if (state.attackMode) {
                    state.selectedTarget = target;
                    weaponModal.style.display = 'flex';
                }
            });
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –∑–¥–æ—Ä–æ–≤—å—è –ø–æ —Ç–∏–ø—É —Ü–µ–ª–∏
        function getMaxHealthByType(type) {
            const healthMap = {
                'bunker': 1500,
                'command': 2000,
                'warehouse': 1500,
                'airfield': 500
            };
            return healthMap[type] || 1000;
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–º–µ–Ω–∏ —Ü–µ–ª–∏ –ø–æ —Ç–∏–ø—É
        function getTargetNameByType(type) {
            const nameMap = {
                'bunker': '–ë—É–Ω–∫–µ—Ä',
                'command': '–ö–æ–º–∞–Ω–¥–Ω—ã–π —Ü–µ–Ω—Ç—Ä',
                'warehouse': '–°–∫–ª–∞–¥ –±–æ–µ–ø—Ä–∏–ø–∞—Å–æ–≤',
                'airfield': '–ê—ç—Ä–æ–¥—Ä–æ–º'
            };
            return nameMap[type] || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —Ü–µ–ª—å';
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–∫–æ–Ω–∫–∏ –ø–æ —Ç–∏–ø—É —Ü–µ–ª–∏
        function getIconByTargetType(type) {
            const iconMap = {
                'bunker': 'üè∞',
                'command': 'üè¢',
                'warehouse': 'üì¶',
                'airfield': '‚úàÔ∏è'
            };
            return iconMap[type] || 'üéØ';
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ –∞—Ç–∞–∫–∏
        function toggleAttackMode() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
            if (!state.currentPlayer) {
                alert('–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É!');
                return;
            }
            
            resetModes();
            state.attackMode = !state.attackMode;
            const btn = document.getElementById('btn-attack-mode');
            
            if (state.attackMode) {
                btn.classList.add('btn-attack');
                btn.textContent = '–†–µ–∂–∏–º –∞—Ç–∞–∫–∏ (–∞–∫—Ç–∏–≤–µ–Ω)';
                addLog('–†–µ–∂–∏–º –∞—Ç–∞–∫–∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω');
                instructions.textContent = '–í—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª—å –¥–ª—è –∞—Ç–∞–∫–∏';
                instructions.style.display = 'block';
            } else {
                btn.classList.remove('btn-attack');
                btn.textContent = '–†–µ–∂–∏–º –∞—Ç–∞–∫–∏';
                instructions.style.display = 'none';
            }
            
            updateModeDisplay();
        }
        
        // –°–±—Ä–æ—Å –≤—Å–µ—Ö —Ä–µ–∂–∏–º–æ–≤
        function resetModes() {
            state.attackMode = false;
            state.addCountryMode = false;
            state.addTargetMode = false;
            
            const btn = document.getElementById('btn-attack-mode');
            btn.classList.remove('btn-attack');
            btn.textContent = '–†–µ–∂–∏–º –∞—Ç–∞–∫–∏';
            
            instructions.style.display = 'none';
            updateModeDisplay();
        }
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –≤—ã–±–æ—Ä–∞ –æ—Ä—É–∂–∏—è
        function closeWeaponModal() {
            weaponModal.style.display = 'none';
            state.selectedTarget = null;
        }
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ç—Ä–∞–Ω—ã
        function closeCountryModal() {
            countryModal.style.display = 'none';
            document.getElementById('country-name').value = '';
            document.getElementById('country-flag').value = '';
            state.selectedCountry = null;
        }
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ü–µ–ª–∏
        function closeTargetModal() {
            targetModal.style.display = 'none';
            state.selectedTarget = null;
        }
        
        // –ó–∞–ø—É—Å–∫ –∞—Ç–∞–∫–∏
        function launchAttack(weaponType) {
            closeWeaponModal();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤—ã–±—Ä–∞–Ω–∞ –ª–∏ —Ü–µ–ª—å
            if (!state.selectedTarget) {
                addLog('–û—à–∏–±–∫–∞: —Ü–µ–ª—å –Ω–µ –≤—ã–±—Ä–∞–Ω–∞');
                return;
            }
            
            // –ù–∞—Ö–æ–¥–∏–º —Å—Ç—Ä–∞–Ω—É –∏–≥—Ä–æ–∫–∞
            const playerCountry = state.countries.find(c => c.owner === state.currentPlayer.username);
            if (!playerCountry) {
                addLog('–û—à–∏–±–∫–∞: —Å—Ç—Ä–∞–Ω–∞ –∏–≥—Ä–æ–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                return;
            }
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∞—Ç–∞–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –æ—Ä—É–∂–∏—è
            let damage, speed, icon, type, sound;
            
            switch(weaponType) {
                case 'otrk':
                    damage = Math.floor(Math.random() * 401) + 100; // 100-500
                    speed = 3000; // –º—Å –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –ø—É—Ç–∏
                    icon = 'üöÄ';
                    type = 'missile';
                    sound = CONFIG.missileSound;
                    break;
                case 'cluster':
                    damage = Math.floor(Math.random() * 101) + 100; // 100-200
                    speed = 4000;
                    icon = 'üí•';
                    type = 'missile';
                    sound = CONFIG.missileSound;
                    break;
                case 'cruise':
                    damage = Math.floor(Math.random() * 401) + 100; // 100-500
                    speed = 5000;
                    icon = '‚úàÔ∏è';
                    type = 'missile';
                    sound = CONFIG.missileSound;
                    break;
                case 'drone':
                    damage = Math.floor(Math.random() * 401) + 100; // 100-500
                    speed = 7000;
                    icon = 'üõ∏';
                    type = 'drone';
                    sound = CONFIG.droneSound;
                    break;
                default:
                    return;
            }
            
            // –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–∞ –∞—Ç–∞–∫–∏
            playSound(sound);
            
            // –°–æ–∑–¥–∞–Ω–∏–µ —Å–Ω–∞—Ä—è–¥–∞
            const projectile = {
                id: Date.now(),
                type: type,
                weapon: weaponType,
                damage: damage,
                speed: speed,
                startX: playerCountry.x, // –Ω–∞—á–∞–ª—å–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è (–æ—Ç —Å—Ç—Ä–∞–Ω—ã –∏–≥—Ä–æ–∫–∞)
                startY: playerCountry.y,
                target: state.selectedTarget,
                icon: icon,
                element: null,
                trail: null,
                owner: state.currentPlayer.username,
                targetOwner: state.selectedTarget.owner || state.selectedTarget.ownerName
            };
            
            state.projectiles.push(projectile);
            renderProjectile(projectile);
            
            addLog(`–ó–∞–ø—É—â–µ–Ω ${getWeaponName(weaponType)} –ø–æ —Ü–µ–ª–∏`);
        }
        
        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–Ω–∞—Ä—è–¥–∞ –Ω–∞ –∫–∞—Ä—Ç–µ
        function renderProjectile(projectile) {
            const projEl = document.createElement('div');
            projEl.className = `projectile ${projectile.type}`;
            projEl.style.left = `${projectile.startX}%`;
            projEl.style.top = `${projectile.startY}%`;
            projEl.innerHTML = projectile.icon;
            projEl.dataset.id = projectile.id;
            projEl.dataset.owner = projectile.owner;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –ø—É–Ω–∫—Ç–∏—Ä–Ω—É—é –ª–∏–Ω–∏—é
            const trail = document.createElement('div');
            trail.className = 'trail';
            trail.style.left = `${projectile.startX}%`;
            trail.style.top = `${projectile.startY}%`;
            
            const targetX = projectile.target.x;
            const targetY = projectile.target.y;
            
            // –í—ã—á–∏—Å–ª—è–µ–º –¥–ª–∏–Ω—É –∏ —É–≥–æ–ª –ª–∏–Ω–∏–∏
            const dx = targetX - projectile.startX;
            const dy = targetY - projectile.startY;
            const length = Math.sqrt(dx * dx + dy * dy);
            const angle = Math.atan2(dy, dx) * 180 / Math.PI;
            
            trail.style.width = `${length}%`;
            trail.style.transform = `rotate(${angle}deg)`;
            
            mapContainer.appendChild(trail);
            mapContainer.appendChild(projEl);
            
            projectile.element = projEl;
            projectile.trail = trail;
            
            // –ó–∞–ø—É—Å–∫ –¥–≤–∏–∂–µ–Ω–∏—è —Å–Ω–∞—Ä—è–¥–∞
            moveProjectile(projectile, targetX, targetY);
        }
        
        // –î–≤–∏–∂–µ–Ω–∏–µ —Å–Ω–∞—Ä—è–¥–∞ –∫ —Ü–µ–ª–∏
        function moveProjectile(projectile, targetX, targetY) {
            const startTime = Date.now();
            const duration = projectile.speed;
            
            function animate() {
                const elapsed = Date.now() - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                if (progress < 1) {
                    // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
                    const currentX = projectile.startX + (targetX - projectile.startX) * progress;
                    const currentY = projectile.startY + (targetY - projectile.startY) * progress;
                    
                    projectile.element.style.left = `${currentX}%`;
                    projectile.element.style.top = `${currentY}%`;
                    
                    requestAnimationFrame(animate);
                } else {
                    // –°–Ω–∞—Ä—è–¥ –¥–æ—Å—Ç–∏–≥ —Ü–µ–ª–∏
                    hitTarget(projectile);
                }
            }
            
            animate();
        }
        
        // –°–Ω–∞—Ä—è–¥ –¥–æ—Å—Ç–∏–≥ —Ü–µ–ª–∏
        async function hitTarget(projectile) {
            // –£–¥–∞–ª—è–µ–º —Å–Ω–∞—Ä—è–¥ –∏ –µ–≥–æ —Å–ª–µ–¥
            if (projectile.element && document.contains(projectile.element)) {
                projectile.element.remove();
            }
            if (projectile.trail && document.contains(projectile.trail)) {
                projectile.trail.remove();
            }
            
            // –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–∞ –≤–∑—Ä—ã–≤–∞
            playSound(CONFIG.explosionSound);
            
            // –ù–∞–Ω–æ—Å–∏–º —É—Ä–æ–Ω —Ü–µ–ª–∏
            let target;
            if (projectile.target.type) {
                // –≠—Ç–æ –æ–±—ã—á–Ω–∞—è —Ü–µ–ª—å
                target = state.targets.find(t => t.id === projectile.target.id);
            } else {
                // –≠—Ç–æ —Å—Ç—Ä–∞–Ω–∞
                target = state.countries.find(c => c.id === projectile.target.id);
            }
            
            if (target) {
                target.health -= projectile.damage;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º health bar
                let targetEl;
                if (projectile.target.type) {
                    targetEl = document.querySelector(`.target[data-id="${target.id}"]`);
                } else {
                    targetEl = document.querySelector(`.country[data-id="${target.id}"]`);
                }
                
                if (targetEl) {
                    const healthFill = targetEl.querySelector('.health-fill');
                    if (healthFill) {
                        const healthPercentage = (target.health / target.maxHealth) * 100;
                        healthFill.style.width = `${healthPercentage}%`;
                        
                        // –ú–µ–Ω—è–µ–º —Ü–≤–µ—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∑–¥–æ—Ä–æ–≤—å—è
                        if (healthPercentage < 30) {
                            healthFill.style.backgroundColor = '#e74c3c';
                        } else if (healthPercentage < 60) {
                            healthFill.style.backgroundColor = '#f39c12';
                        }
                    }
                }
                
                addLog(`${getWeaponName(projectile.weapon)} –Ω–∞–Ω–µ—Å —É—Ä–æ–Ω ${projectile.damage} –ø–æ —Ü–µ–ª–∏`);
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ë–î
                if (projectile.target.type) {
                    await apiRequest('update_target', { target });
                } else {
                    await apiRequest('update_country', { country: target });
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∞ –ª–∏ —Ü–µ–ª—å
                if (target.health <= 0) {
                    target.health = 0;
                    if (targetEl) {
                        targetEl.style.opacity = '0.5';
                    }
                    addLog(`–¶–µ–ª—å —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∞!`);
                }
            }
        }
        
        // –ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø–µ—Ä–µ—Ö–≤–∞—Ç—á–∏–∫–∞
        function activateInterceptor() {
            if (state.interceptorCooldown > 0) return;
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º cooldown
            state.interceptorCooldown = 2;
            interceptorBtn.disabled = true;
            interceptorCdSpan.textContent = state.interceptorCooldown;
            
            // –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–∞ –ø–µ—Ä–µ—Ö–≤–∞—Ç—á–∏–∫–∞
            playSound(CONFIG.interceptorSound);
            
            // –ü–æ–ø—ã—Ç–∫–∞ —Å–±–∏—Ç—å –∫–∞–∂–¥—ã–π —Å–Ω–∞—Ä—è–¥ —Å —à–∞–Ω—Å–æ–º 70%
            let intercepted = false;
            state.projectiles.forEach(projectile => {
                // –ú–æ–∂–Ω–æ —Å–±–∏–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å–Ω–∞—Ä—è–¥—ã, –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –Ω–∞ —Ü–µ–ª–∏, –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—â–∏–µ –∏–≥—Ä–æ–∫—É
                let isTargetOwnedByPlayer = false;
                
                if (projectile.target.type) {
                    // –≠—Ç–æ –æ–±—ã—á–Ω–∞—è —Ü–µ–ª—å
                    const target = state.targets.find(t => t.id === projectile.target.id);
                    if (target) {
                        const targetOwner = state.countries.find(c => c.id === target.owner);
                        isTargetOwnedByPlayer = targetOwner && targetOwner.owner === state.currentPlayer.username;
                    }
                } else {
                    // –≠—Ç–æ —Å—Ç—Ä–∞–Ω–∞
                    const target = state.countries.find(c => c.id === projectile.target.id);
                    isTargetOwnedByPlayer = target && target.owner === state.currentPlayer.username;
                }
                
                if (isTargetOwnedByPlayer && Math.random() < 0.7) {
                    // –°–±–∏–≤–∞–µ–º —Å–Ω–∞—Ä—è–¥
                    if (projectile.element && document.contains(projectile.element)) {
                        projectile.element.remove();
                    }
                    if (projectile.trail && document.contains(projectile.trail)) {
                        projectile.trail.remove();
                    }
                    addLog(`–°–Ω–∞—Ä—è–¥ —Å–±–∏—Ç –ø–µ—Ä–µ—Ö–≤–∞—Ç—á–∏–∫–æ–º!`);
                    intercepted = true;
                }
            });
            
            if (intercepted) {
                addLog(`–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –ø–µ—Ä–µ—Ö–≤–∞—Ç—á–∏–∫ - —Å–Ω–∞—Ä—è–¥—ã —Å–±–∏—Ç—ã!`);
            } else {
                addLog(`–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –ø–µ—Ä–µ—Ö–≤–∞—Ç—á–∏–∫ - –Ω–µ —É–¥–∞–ª–æ—Å—å —Å–±–∏—Ç—å —Å–Ω–∞—Ä—è–¥—ã`);
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ cooldown
        function updateCooldowns() {
            if (state.interceptorCooldown > 0) {
                state.interceptorCooldown -= 1;
                interceptorCdSpan.textContent = state.interceptorCooldown;
                
                if (state.interceptorCooldown <= 0) {
                    interceptorBtn.disabled = false;
                    interceptorCdSpan.textContent = '0';
                }
            }
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –æ—Ä—É–∂–∏—è –ø–æ —Ç–∏–ø—É
        function getWeaponName(weaponType) {
            const nameMap = {
                'otrk': '–û–¢–†–ö',
                'cluster': '–ö–∞—Å—Å–µ—Ç–Ω–∞—è —Ä–∞–∫–µ—Ç–∞',
                'cruise': '–ö—Ä—ã–ª–∞—Ç–∞—è —Ä–∞–∫–µ—Ç–∞',
                'drone': '–ë–ü–õ–ê'
            };
            return nameMap[weaponType] || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ –æ—Ä—É–∂–∏–µ';
        }
        
        // –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–∞
        function playSound(soundFile) {
            // –ó–ê–ú–ï–ù–ò–¢–ï –Ω–∞ –≤–∞—à—É —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∑–≤—É–∫–∞
            console.log(`Playing sound: ${soundFile}`);
            // –ü—Ä–∏–º–µ—Ä: new Audio(soundFile).play();
        }
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ –∂—É—Ä–Ω–∞–ª
        function addLog(message) {
            const now = new Date();
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const seconds = now.getSeconds().toString().padStart(2, '0');
            const timeStr = `[${hours}:${minutes}:${seconds}]`;
            
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.innerHTML = `<span class="log-time">${timeStr}</span> ${message}`;
            
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
            
            state.lastLogTime = now;
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ —Ä–µ–∂–∏–º–∞
        function updateModeDisplay() {
            let modeText = '–¢–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º: ';
            
            if (state.attackMode) {
                modeText += '–ê—Ç–∞–∫–∞';
            } else if (state.addCountryMode) {
                modeText += '–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω—ã';
            } else if (state.addTargetMode) {
                modeText += '–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ü–µ–ª–∏';
            } else {
                modeText += '–í—ã–±–æ—Ä';
            }
            
            currentMode.textContent = modeText;
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
        async function saveToDatabase() {
            dbLoading.style.display = 'block';
            addLog('–ü–æ–ø—ã—Ç–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ MySQL...');
            
            const result = await apiRequest('save_all', {
                countries: state.countries,
                targets: state.targets
            });
            
            dbLoading.style.display = 'none';
            
            if (result.success) {
                addLog('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ MySQL');
                alert('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ MySQL!');
            } else {
                addLog('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö: ' + result.error);
                alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö: ' + result.error);
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
        async function loadFromDatabase() {
            dbLoading.style.display = 'block';
            addLog('–ü–æ–ø—ã—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ MySQL...');
            
            const result = await apiRequest('load_all', {});
            
            dbLoading.style.display = 'none';
            
            if (result.success) {
                // –û—á–∏—â–∞–µ–º –∫–∞—Ä—Ç—É
                clearMap();
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                state.countries = result.countries || [];
                state.targets = result.targets || [];
                
                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                state.countries.forEach(country => renderCountry(country));
                state.targets.forEach(target => renderTarget(target));
                
                addLog('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ MySQL');
            } else {
                addLog('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: ' + result.error);
                alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: ' + result.error);
            }
        }
        
        // –û—á–∏—Å—Ç–∫–∞ –∫–∞—Ä—Ç—ã
        function clearMap() {
            // –£–¥–∞–ª—è–µ–º –≤—Å–µ —Å—Ç—Ä–∞–Ω—ã
            document.querySelectorAll('.country').forEach(el => el.remove());
            
            // –£–¥–∞–ª—è–µ–º –≤—Å–µ —Ü–µ–ª–∏
            document.querySelectorAll('.target').forEach(el => el.remove());
            
            // –£–¥–∞–ª—è–µ–º –≤—Å–µ —Å–Ω–∞—Ä—è–¥—ã
            document.querySelectorAll('.projectile').forEach(el => el.remove());
            
            // –£–¥–∞–ª—è–µ–º –≤—Å–µ —Å–ª–µ–¥—ã
            document.querySelectorAll('.trail').forEach(el => el.remove());
            
            // –û—á–∏—â–∞–µ–º –º–∞—Å—Å–∏–≤—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π
            state.countries = [];
            state.targets = [];
            state.projectiles = [];
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', init);
    </script>
</body>
</html>